
	<!--
		TestProcess BPEL Process [Generated by the Eclipse BPEL Designer]
	-->
<bpel:process name="TestProcess2"
	targetNamespace="http://decidr.de/Default_Tenant/processes/303"
	xmlns="http://docs.oasis-open.org/wsbpel/2.0/process/executable"
	xmlns:ws1="http://decidr.de/webservices/Email" xmlns:ws2="http://decidr.de/webservices/HumanTask"
	xmlns:basic="http://decidr.de/wsdl/basicProcess" xmlns:ode="http://www.apache.org/ode/type/extension"
	xmlns:decidr="http://decidr.de/schema/DecidrTypes" xmlns:pdecidr="http://decidr.de/schema/DecidrProcessTypes"
	xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:hut="http://decidr.de/schema/humanTask"
	xmlns:tns="http://decidr.de/Default_Tenant/processes/303" xmlns:bpel="http://docs.oasis-open.org/wsbpel/2.0/process/executable">

	<!-- Import the client WSDL -->
	<bpel:import namespace="http://decidr.de/wsdl/basicProcess"
		location="odeprocess.wsdl" importType="http://schemas.xmlsoap.org/wsdl/"></bpel:import>
	<bpel:import namespace="http://decidr.de/webservices/HumanTask"
		location="HumanTask.wsdl" importType="http://schemas.xmlsoap.org/wsdl/"></bpel:import>
	<bpel:import location="TestProcessArtifacts.wsdl"
		namespace="http://decidr.de/Default_Tenant/processes/303" importType="http://schemas.xmlsoap.org/wsdl/" />

	<!--
		=================================================================
	-->
	<!--
		PARTNERLINKS
	-->
	<!--
		List of services participating in this BPEL process
	-->
	<!--
		=================================================================
	-->
	<bpel:partnerLinks>
		<!-- The 'client' role represents the requester of this service. -->
		<bpel:partnerLink name="client" partnerLinkType="tns:ProcessPLT"
			myRole="EmailTestProvider" />
		<bpel:partnerLink name="EmailService"
			partnerLinkType="ws1:EmailPLT" partnerRole="EmailProvider"></bpel:partnerLink>
	</bpel:partnerLinks>

	<!--
		=================================================================
	-->
	<!--
		VARIABLES
	-->
	<!--
		List of messages and XML documents used within this BPEL process
	-->
	<!--
		=================================================================
	-->
	<bpel:variables>
		<!-- BPEL process variables -->
		<bpel:variable name="processIn" messageType="tns:startMessageRequest" />
		<bpel:variable name="processOut" messageType="tns:startMessageResponse" />
		<bpel:variable name="wfmid" type="xsd:long" />
		<bpel:variable name="sendEmailIn" messageType="ws1:sendEmailRequest" />
		<bpel:variable name="sendEmailOut" messageType="ws1:sendEmailResponse" />
         
        <!--The fault message -->
		<bpel:variable name="L1260445451575" type="xsd:string" />
		<!--The success message -->
		<bpel:variable name="L1260445559543" type="xsd:string" />
		<!--The send email message -->
		<bpel:variable name="L1260455349758" type="xsd:string" />

        <!-- User 1 -->
		<bpel:variable name="L1260445287013" element="decidr:role" />
	</bpel:variables>

	<!--
		=================================================================
	-->
	<!--
		ORCHESTRATION LOGIC
	-->
	<!--
		Set of activities coordinating the flow of messages across the
	-->
	<!--
		services integrated within this business process
	-->
	<!--
		=================================================================
	-->
	<bpel:correlationSets>
		<bpel:correlationSet name="taskCorrelation" properties="tns:taskID"></bpel:correlationSet>
	</bpel:correlationSets>
	<bpel:sequence name="main">

		<!--
			Receive input from requester. Note: This maps to operation defined in
			TestProcess.wsdl
		-->
		<bpel:receive name="receiveInput" partnerLink="client"
			createInstance="yes" operation="startProcess" portType="tns:EmailTestPT"
			variable="processIn" />

		<!-- Generate reply to synchronous request -->
		<bpel:assign validate="no" name="Assign">
			<bpel:copy>
				<bpel:from>
					<bpel:literal xml:space="preserve">
					   <tns:startProcessresponse
						xmlns:tns="http://decidr.de/Default_Tenant/processes/303"
						xmlns:tns1="http://decidr.de/schema/DecidrTypes" 
						xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
                          <tns:pid></tns:pid>
                       </tns:startProcessresponse>
                    </bpel:literal>
				</bpel:from>
				<bpel:to variable="processOut" part="payload"></bpel:to>
			</bpel:copy>
			<bpel:copy>
				<bpel:from>
                    <![CDATA[$ode:pid]]>
				</bpel:from>
				<bpel:to part="payload" variable="processOut">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:pid]]></bpel:query>
				</bpel:to>
			</bpel:copy>
		</bpel:assign>
		<assign name="initVariables">
			<copy>
				<from>
					<literal>This fault message is created by the fault handler of the
						corresponding BPEL process</literal>
				</from>
				<to variable="L1260445451575" />
			</copy>
			<copy>
				<from>
					<literal>BPEL process successfully completed.</literal>
				</from>
				<to variable="L1260445559543" />
			</copy>
		</assign>
		<assign name="initRoles">
			<copy>
				<from>
					<literal>
						<basic:role name="L1260445287013">
							<basic:actor userId="1" />
						</basic:role>
					</literal>
				</from>
				<to variable="L1260445287013" />
			</copy>
		</assign>
		<bpel:reply name="replyOutput" partnerLink="client"
			portType="tns:EmailTestPT" operation="startProcess" variable="processOut" />
		<bpel:sequence name="Sequence">
			<bpel:assign validate="no" name="Assign1">
				<bpel:copy>
					<bpel:from>
						<bpel:literal xml:space="preserve">
						  <ws1:sendEmail
							xmlns:ws1="http://decidr.de/webservices/Email">
         						<ws1:to />
         						<ws1:fromAddress />
						        <ws1:subject />
						        <ws1:bodyTXT />
      					  </ws1:sendEmail>
                       </bpel:literal>
					</bpel:from>
					<bpel:to part="parameters" variable="sendEmailIn"></bpel:to>
				</bpel:copy>
				<bpel:copy>
					<bpel:from part="payload" variable="processIn">
						<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:role/decidr:actor/@userid]]></bpel:query>
					</bpel:from>
					<bpel:to part="parameters" variable="sendEmailIn">
						<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                            <![CDATA[to]]>
						</bpel:query>
					</bpel:to>
				</bpel:copy>
			</bpel:assign>
			<bpel:invoke name="Invoke" partnerLink="EmailService"
				operation="sendEmail" portType="ws1:EmailPT" inputVariable="sendEmailIn"
				outputVariable="sendEmailOut">
			</bpel:invoke>
		</bpel:sequence>
	</bpel:sequence>
</bpel:process>

