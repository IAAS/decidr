<?xml version="1.0" encoding="UTF-8"?>
	<workflow id="1544" name="PartyOrganization" 
	 targetNamespace="http://decidr.de/decidr/party"
	 xmlns="http://decidr.de/schema/dwdl">
		<variables>
			<variable name="partydate" type="date"
		     configurationVariable="yes" >
		    </variable>
		    <variable name="faultMessage" type="string"
		     configurationVariable="yes" >
		    </variable>
		    <variable name="successOrganizationMessage" type="string">
		      <initialValue>Party organization successfully finished</initialValue>
		    </variable>
			<variable name="invitationFormResult" type="form" />
		</variables>
		<roles>
			<role name="guests"
		     configurationVariable="yes" />
		    <role name="vip-guests">
				<actor email="vip1@example.com" name="VIP1-Guest" userId="123456789"/>
				<actor email="vip2@example.com" name="VIP2-Guest" userId="123456790"/>
		    </role>
			<actor name="host" email="host@example.com" userId="1234567891"/>
		</roles>
		<faultHandler>
			<setProperty
		     name="message"
		     variable="faultMessage">
		    </setProperty>
		    <recipient>
		      <setProperty
		       name="name">
		        <propertyValue> 
		          Boss
		        </propertyValue>
		      </setProperty>
		      <setProperty
		       name="email">
		        <propertyValue>
		          boss@example.com
		        </propertyValue>
		       </setProperty>
		    </recipient>
		</faultHandler>
		<nodes>
		    <startNode id="s1">
				<graphics x="20" y="30"/>
				<sources>
					<source arcID="s1-to-i1"/>
				</sources>
			</startNode>
			<invokeNode id="i1"
		     activity="Decidr-Email">
				<description>
					Sends all guest an invitation
				</description>
				<graphics x="20" y="30"/>
				<targets>
					<target arcID="s1-to-i1" />
				</targets>
				<sources>
					<source arcID="i1-to-f1"/>
				</sources>
				<setProperty 
				 name="to"
				 variable="guests" />
				<setProperty 
				 name="cc"
				 variable="host"/>
				<setProperty 
				 name="subject">
					<propertyValue>
						Party invitation
					</propertyValue>
				</setProperty>
				<setProperty 
				 name="message">
					<propertyValue>
						Dear friend, i would like to invite you to my party. 
						You soon will be prompted to fill out a form.
						Regards,
						Mr. X
					</propertyValue>
				</setProperty>
			</invokeNode>
			<forEachNode id="f1"
		     counterName="g"
		     parallel="yes">
				<graphics x="20" y="30"/>
				<targets>
					<target arcID="i1-to-f1"/>
				</targets>
				<sources>
					<source arcID="f1-to-e1"/>
				</sources>
				<startCounterValue>
					1
				</startCounterValue>
				<finalCounterValue>
					$guests
				</finalCounterValue>
				<completionCondition>
					AND
				</completionCondition>
				<nodes>
					<invokeNode id="i2"
					 activity="Decidr-HumanTask">
						<description>
							Task to figure out who will attend the party
							and what he is going to bring.
						</description>
						<graphics height="20" width="30"/>
						<setProperty 
						 name="wfmID">
							<propertyValue>
								544
							</propertyValue>
						</setProperty>
						<setProperty 
						 name="user">
							<propertyValue>
								$g
							</propertyValue>
						</setProperty>
						<setProperty 
						 name="name">
							<propertyValue>
								Invitation form
							</propertyValue>
						</setProperty>
						<setProperty 
						 name="description">
							<propertyValue>
								Please fill in the form. It would be nice if somebody
								can bring a cake and a barbecue. I'm looking forward
								to meet you.
							</propertyValue>
						</setProperty>
						<setProperty 
						 name="userNotification">
							<propertyValue>
								yes 
							</propertyValue>
						</setProperty>
						<getProperty
						 name="taskResult"
						 variable = "invitationFormResult" />
						<humanTaskData>
							<parameters>
								<parameter name="p_date" 
								 type="date" 
								 variable="partydate" />
							</parameters>
							<information name="NCName">
								<content contentType="text/plain">
									The party will be on $p_date.
								</content> 
							</information>
							<taskItem name="attendance"
							 type="boolean">
								<label>Will you participate?</label>
								<hint>Please type yes or no</hint> ?
								<value>your choice ...</value>
							</taskItem>
							<taskItem name="food"
							 type="string">
								<label>Which finger food are you going to make?</label>
								<hint>Don't forget the cake and the barbecue</hint>
								<value>your choice ...</value>
							</taskItem>
						</humanTaskData>
					</invokeNode>
				</nodes>
		    </forEachNode>
		    <endNode id="e1">
		      <graphics x="20" y="30"/>
		      <targets>
		        <target arcID="f1-to-e1" />
		      </targets>
		      <notificationOfSuccess>
		        <setProperty
		         name="successMessage"
		         variable="successOrganizationMessage">
		        </setProperty>
				<setProperty
		         name="to"
		         variable="host">
		        </setProperty>
		      </notificationOfSuccess>
		    </endNode>
		  </nodes>
		  <arcs>
		    <arc id="s1-to-i1" sourceNode="s1" targetNode="i1"/>
			<arc id="i1-to-f1" sourceNode="i1" targetNode="f1"/>
			<arc id="f1-to-e1" sourceNode="f1" targetNode="e1"/>
		  </arcs>
		</workflow>