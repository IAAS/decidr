<!-- A proxy service that performs load balancing -->
<definitions xmlns="http://ws.apache.org/ns/synapse">
  <sequence name="timeFault">
      <!-- Logs and discards the message. -->
      <log level="full"/>    
      <drop/>
  </sequence>

  <proxy name="LoadBalancedTimeProxy" transports="http,https">
    <target faultSequence="timeFault">
      <inSequence>
        <send>
          <endpoint>
            <!-- The roundRobin is the only available algorithm at 
                 the moment -->
            <loadbalance algorithm="roundRobin">
              <endpoint>
                <address uri="http://localhost:9000/soap/TimeService">
                  <!-- Activates WS-Addressing for this endpoint -->
                  <enableAddressing/>
                  <!-- If we do not specify a suspend duration, the 
                       endpoint will be permanently disabled upon 
                       failure -->
                  <suspendDurationOnFailure>30</suspendDurationOnFailure>
                </address>
              </endpoint>
              <endpoint>
                <address uri="http://localhost:8000/soap/TimeService">
                  <enableAddressing/>
                  <suspendDurationOnFailure>30</suspendDurationOnFailure>
                </address>
              </endpoint>
              <endpoint>
                <address uri="http://localhost:7000/soap/TimeService">
                  <enableAddressing/>
                  <suspendDurationOnFailure>30</suspendDurationOnFailure>
                </address>
              </endpoint>
            </loadbalance>
          </endpoint>
        </send>
        <drop/>
      </inSequence>
      <outSequence>
        <send/>
      </outSequence>
    </target>
    <publishWSDL uri="file:repository/conf/sample/resources/TimeService.wsdl"/>
  </proxy>
  
  <sequence name="main">
    <drop/>
  </sequence>
</definitions> 